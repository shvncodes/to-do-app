<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>to-do App</title>
     <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body{
            background-color: #3868d7;
        }

        #main{
            width: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        #heading{
            color: white;
        }
        #box{
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
            border-radius: 20px;
            padding: 10px;
            width: 100%;
            max-width: 500px;
        }

        #inputBox{
            display: flex;
            justify-content: space-evenly;
            align-items: center;
            gap: 20px;
            border-radius: 20px;
            padding: 10px;
            width: 100%;
            max-width: 500px;
        }
        input {
            width: 100%;
            max-width: 400px;
            padding: 10px;
            border: 2px solid blue;
            border-radius: 5px;
            font-size: 15px;
        }
        input:hover {
           background-color: rgb(237, 235, 235);
        }
        #add, .done, .delete{  
            border-radius: 5px;
            font-size: 15px;
            padding: 10px 25px;
            background-color: rgb(117, 117, 255);
            color: white;
            cursor: pointer;
        }
        #add:hover{
            background-color: rgb(154, 154, 255);;
        }

        .done{
            background-color: green;
        }
        .done:hover{
            background-color: rgb(23, 177, 23);
        }

        .delete{
            background-color: crimson;
        }
        .delete:hover{
            background-color: red;
        }

        #toDoBox{
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
            border-radius: 20px;
            padding: 10px;
            width: 100%;
            max-width: 500px;
        }
        .buttons {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        .item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            border-radius: 10px;
            padding: 10px;
            width: 100%;
            max-width: 500px;
            background-color: rgb(173, 226, 247);
        }

        .item p {
            word-break: break-word;
        }

        .taskCompleted p {
            text-decoration: line-through;
            color: gray;
        }

        .disabled, .disabled:hover {
            background-color: grey;
            cursor: not-allowed;
        }
        
        .message{
            display: flex;
            width: 100%;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            opacity: 50%;
            min-height: 200px;
        }

        @media screen and (max-width: 760px) {
            .buttons{
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="main">
        <h1 id="heading">To-do list</h1>
        <div id="box">
            <div id="inputBox">
                <input id="taskInput" type="text" placeholder="Enter to-do item" required>
                <button id="add" type="button">Add</button>
            </div>
            <div id="toDoBox"></div>
        </div>
    </div>

    <script>
        const taskInput = document.querySelector("#taskInput");
        const addButton = document.querySelector("#add");
        const toDoBox = document.querySelector("#toDoBox");
        const LOCAL_STORAGE_KEY = "all_tasks";

        let allTasks = [] 
        /*
            TASK = {
                taskId: "task-id",
                title: "Potty karni hai",
                isCompleted: false
            }
        */

        function saveTasksinLS() {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(allTasks));
        }

        const localStorageTasks = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) ?? [];
        localStorageTasks.forEach((task) => {
            // push into allTasks
            allTasks.push(task);
            // create Div and process that
            createItemDiv(task);
        })
        
        const emptyStateDiv = document.createElement("div");
        emptyStateDiv.className = "message";
        emptyStateDiv.textContent = "No tasks yet!"
        if(allTasks.length === 0) {
            toDoBox.append(emptyStateDiv);
        }

        function createButtons(item, taskObj) {
            const buttons = document.createElement("div");
            const complete = document.createElement("button");
            complete.className = "done";
            complete.innerText = "Done";
            if(taskObj.isCompleted) {
                complete.disabled = true;
                complete.classList.add("disabled");
            }
            complete.addEventListener("click", () => {
                item.classList.add("taskCompleted");
                const updatedTasks = allTasks.map((task) => {
                    if(task.taskId === taskObj.taskId) {
                        complete.disabled = true;
                        complete.classList.add("disabled");
                        return {
                            taskId: task.taskId,
                            title: task.title,
                            isCompleted: true
                        }
                    }
                    return task;
                })
                allTasks = [...updatedTasks];
                saveTasksinLS();
            });
            
            const del = document.createElement("button");
            del.className = "delete";
            del.innerText = "Delete";
            del.addEventListener("click", () => {
                toDoBox.removeChild(item);
                // filter the 
                const filteredTasks = allTasks.filter((task) =>{
                    if(task.taskId === taskObj.taskId) return false;
                    return true;
                })
                allTasks = [...filteredTasks];
                saveTasksinLS();
                
                if(toDoBox.children.length === 0) {
                    toDoBox.append(emptyStateDiv);
                }
            });
            
            buttons.className = "buttons";
            buttons.append(complete);
            buttons.append(del);
            return buttons;
        }

        function createItemDiv(task) {
            const div = document.createElement("div");
            div.className = "item";
            if(task.isCompleted) {
                div.classList.add("taskCompleted");
            }

            const para = document.createElement('p');
            para.textContent = task.title;
            div.append(para);
            
            const buttons = createButtons(div, task);
            div.append(buttons);

            toDoBox.prepend(div);
            toDoBox.style.display = "flex";
        }

        function insertToDo() {
            const text = taskInput.value.trim();
            if(!text){
                alert("Please enter valid task");
                return;
            } 

            if(toDoBox.children.length === 1 && toDoBox.children[0].isSameNode(emptyStateDiv)) {
                // remove the emptyStateDiv
                toDoBox.removeChild(emptyStateDiv);
            }

            const taskId =  Date.now() + Math.random().toString(16).slice(2);
            const taskObj = {
                taskId: taskId,
                title: text,
                isCompleted: false
            }

            allTasks.push(taskObj);
            saveTasksinLS();
            createItemDiv(taskObj)
        }

        addButton.addEventListener("click", ()=> {
            insertToDo();
            taskInput.value = "";
        });

        taskInput.addEventListener("keydown", function(event) {
            if(event.key === "Enter") {
                insertToDo();
                taskInput.value = "";
            }
        });

    </script>
</body>
</html>